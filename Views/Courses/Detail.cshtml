@model paradise.Models.ViewModels.CourseDetailVM
@{
    Layout = "~/Views/Shared/_CourseLayout.cshtml";
    ViewBag.Title = Model.CourseTitle;
}
@section pageTitle { @Model.CourseTitle }


<div class="offcanvas offcanvas-end" tabindex="-1" id="lessonDrawer">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title">Danh sách bài</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
        <div id="sidebar-mobile"></div>
    </div>
</div>

<!-- WRAPPER 2 CỘT -->
<div id="learnLayout" class="learn-layout">
    <!-- LEFT: video + content -->
    <section class="learn-main">
        <div class="mb-3 learning-card p-0 position-relative" id="player">
            <div class="ratio ratio-16x9">
                <video id="lessonVideo" class="w-100 h-100 rounded" playsinline preload="metadata">
                    <source id="videoSource" src="" type="video/mp4" />
                    Trình duyệt không hỗ trợ video.
                </video>
            </div>
            

            <!-- Custom controls -->
            <div class="v-controls" id="vControls" aria-label="Trình điều khiển video">
                <button class="vc-btn" id="vc-play" aria-label="Phát / Tạm dừng">
                    <!-- play -->
                    <svg id="ico-play" viewBox="0 0 16 16" width="18" height="18"><path d="M3 2l10 6-10 6z" fill="currentColor" /></svg>
                    <!-- pause (ẩn mặc định) -->
                    <svg id="ico-pause" viewBox="0 0 16 16" width="18" height="18" style="display:none"><path d="M3 2h4v12H3zM9 2h4v12H9z" fill="currentColor" /></svg>
                </button>

                <div class="vc-progress" id="vc-progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
                    <div class="vc-bar" id="vc-bar"></div>
                </div>

                <div class="vc-time">
                    <span id="vc-cur">00:00</span> / <span id="vc-dur">00:00</span>
                </div>

                <button class="vc-btn" id="vc-mute" aria-label="Bật/tắt tiếng">
                    <svg id="ico-vol" xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="18" height="18" viewBox="0 0 24 24"><path d="M5 17h-5v-10h5v10zm2-10v10l9 5v-20l-9 5zm11.008 2.093c.742.743 1.2 1.77 1.198 2.903-.002 1.133-.462 2.158-1.205 2.9l1.219 1.223c1.057-1.053 1.712-2.511 1.715-4.121.002-1.611-.648-3.068-1.702-4.125l-1.225 1.22zm2.142-2.135c1.288 1.292 2.082 3.073 2.079 5.041s-.804 3.75-2.096 5.039l1.25 1.254c1.612-1.608 2.613-3.834 2.616-6.291.005-2.457-.986-4.681-2.595-6.293l-1.254 1.25z" /></svg>
                    <svg id="ico-mute" xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="18" height="18" viewBox="0 0 24 24"><path d="M5 17h-5v-10h5v10zm2-10v10l9 5v-20l-9 5zm15.324 4.993l1.646-1.659-1.324-1.324-1.651 1.67-1.665-1.648-1.316 1.318 1.67 1.657-1.65 1.669 1.318 1.317 1.658-1.672 1.666 1.653 1.324-1.325-1.676-1.656z" /></svg>
                </button>

                <input type="range" id="vc-volume" min="0" max="1" step="0.01" value="1" aria-label="Âm lượng" />

                <select id="vc-speed" aria-label="Tốc độ">
                    <option value="0.5">0.5×</option>
                    <option value="0.75">0.75×</option>
                    <option value="1" selected>1×</option>
                    <option value="1.25">1.25×</option>
                    <option value="1.5">1.5×</option>
                    <option value="2">2×</option>
                </select>

                <button class="vc-btn" id="vc-full" aria-label="Toàn màn hình">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="18" height="18" viewBox="0 0 24 24"><path d="M24 9h-2v-5h-7v-2h9v7zm-9 13v-2h7v-5h2v7h-9zm-15-7h2v5h7v2h-9v-7zm9-13v2h-7v5h-2v-7h9z" /></svg>
                </button>
            </div>
        </div>


        <div id="lessonContent" class="p-3 learning-card mb-3"></div>
        @*<div id="quizContainer" class="learning-card p-3"></div>*@
    </section>

    <!-- RIGHT: sidebar luôn ở cột phải -->
    <aside id="sidebarPane" class="learn-sidebar learning-card">
        <div id="sidebar"></div>
    </aside>
</div>

<!-- Nút 3 gạch bật/tắt sidebar (desktop + tablet) -->
<button id="btnToggleSidebar" class="learn-fab fab-toggle d-none d-lg-inline-block" title="Ẩn/hiện danh sách bài">
    &#9776;
</button>

<!-- Drawer mobile -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="lessonDrawer">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title">Danh sách bài</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
        <div id="sidebar-mobile"></div>
    </div>
</div>




@section scripts{
    <script>
    window.COURSE_DATA = @Html.Raw(
      Newtonsoft.Json.JsonConvert.SerializeObject(
        Model.Sections,
        new Newtonsoft.Json.JsonSerializerSettings {
          ContractResolver = new Newtonsoft.Json.Serialization.CamelCasePropertyNamesContractResolver()
        }
      )
    );
    window.COURSE_TITLE      = "@Model.CourseTitle";
    window.CURRENT_LESSON_ID = "@(Model.CurrentLessonId ?? "")";
    window.COURSE_KEY        = "course:@Model.CourseId";
    </script>
    <script>window.FRESH_PROGRESS = true;</script>
    <script src="~/Scripts/course-detail/course-detail.js"></script>
    <script src="~/Scripts/course-detail/custom-player.js"></script>
}
